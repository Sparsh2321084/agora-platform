"use strict";(self.webpackChunkagora_platform=self.webpackChunkagora_platform||[]).push([[791],{2406:(e,s,t)=>{t.d(s,{A:()=>o});var i=t(5043),a=t(5396),n=t(579);const o=e=>{let{end:s,duration:t=2e3,prefix:o="",suffix:r="",className:c=""}=e;const[l,d]=(0,i.useState)(0),[u,h]=(0,a.wd)({once:!0,threshold:.3}),m=(0,i.useRef)(!1);return(0,i.useEffect)(()=>{if(h&&!m.current){let e,i;m.current=!0;const a=n=>{e||(e=n);const o=Math.min((n-e)/t,1),r=1-Math.pow(1-o,4);d(Math.floor(r*s)),o<1&&(i=requestAnimationFrame(a))};return i=requestAnimationFrame(a),()=>{i&&cancelAnimationFrame(i)}}},[h,s,t]),(0,n.jsxs)("span",{ref:u,className:c,children:[o,l.toLocaleString(),r]})}},2791:(e,s,t)=>{t.r(s),t.d(s,{default:()=>f});var i=t(2555),a=t(5043),n=t(9001),o=t(5897),r=t(6042),c=t(8660),l=t(2406),d=t(6995),u=t(3488),h=t(6255),m=t(7575);const g=new class{constructor(){this.db=null,this.initPromise=this.init()}async init(){return new Promise((e,s)=>{const t=indexedDB.open("AgoraPlatform",1);t.onerror=()=>s(t.error),t.onsuccess=()=>{this.db=t.result,e(this.db)},t.onupgradeneeded=e=>{const s=e.target.result;if(!s.objectStoreNames.contains("discussions")){const e=s.createObjectStore("discussions",{keyPath:"id"});e.createIndex("category","category",{unique:!1}),e.createIndex("username","username",{unique:!1}),e.createIndex("created_at","created_at",{unique:!1}),e.createIndex("views","views",{unique:!1})}if(!s.objectStoreNames.contains("replies")){const e=s.createObjectStore("replies",{keyPath:"id",autoIncrement:!0});e.createIndex("discussionId","discussionId",{unique:!1}),e.createIndex("username","username",{unique:!1})}if(s.objectStoreNames.contains("userProfile")||s.createObjectStore("userProfile",{keyPath:"userId"}),!s.objectStoreNames.contains("offlineQueue")){s.createObjectStore("offlineQueue",{keyPath:"id",autoIncrement:!0}).createIndex("timestamp","timestamp",{unique:!1})}}})}async get(e,s){return await this.initPromise,new Promise((t,i)=>{const a=this.db.transaction(e,"readonly").objectStore(e).get(s);a.onsuccess=()=>t(a.result),a.onerror=()=>i(a.error)})}async getAll(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return await this.initPromise,new Promise((t,i)=>{const a=this.db.transaction(e,"readonly").objectStore(e).getAll(null,s);a.onsuccess=()=>t(a.result),a.onerror=()=>i(a.error)})}async getByIndex(e,s,t){return await this.initPromise,new Promise((i,a)=>{const n=this.db.transaction(e,"readonly").objectStore(e).index(s).getAll(t);n.onsuccess=()=>i(n.result),n.onerror=()=>a(n.error)})}async put(e,s){return await this.initPromise,new Promise((t,i)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).put(s);a.onsuccess=()=>t(a.result),a.onerror=()=>i(a.error)})}async putBatch(e,s){return await this.initPromise,new Promise((t,i)=>{const a=this.db.transaction(e,"readwrite"),n=a.objectStore(e);s.forEach(e=>n.put(e)),a.oncomplete=()=>t(),a.onerror=()=>i(a.error)})}async delete(e,s){return await this.initPromise,new Promise((t,i)=>{const a=this.db.transaction(e,"readwrite").objectStore(e).delete(s);a.onsuccess=()=>t(),a.onerror=()=>i(a.error)})}async clear(e){return await this.initPromise,new Promise((s,t)=>{const i=this.db.transaction(e,"readwrite").objectStore(e).clear();i.onsuccess=()=>s(),i.onerror=()=>t(i.error)})}async queueOfflineAction(e){await this.put("offlineQueue",(0,i.A)((0,i.A)({},e),{},{timestamp:Date.now(),retries:0}))}async getOfflineQueue(){return this.getAll("offlineQueue")}};async function p(){const e=await g.getOfflineQueue();for(const t of e)try{await fetch(t.url,{method:t.method,headers:t.headers,body:t.body}),await g.delete("offlineQueue",t.id)}catch(s){console.error("Failed to process queued action:",s)}}"undefined"!==typeof window&&window.addEventListener("online",p);const v={initial:{opacity:0,y:30},animate:{opacity:1,y:0,transition:{duration:.5,ease:"easeOut"}}};var x=t(579);const j=(0,a.memo)(e=>{var s,t;let{disc:i,index:n,onNavigate:o,userId:r}=e;const c=(0,a.useCallback)(e=>{e.target.closest(".vote-container")||o("/discussion/".concat(i.id))},[i.id,o]),l=(0,a.useCallback)(e=>{e.stopPropagation(),o("/discussion/".concat(i.id))},[i.id,o]);return(0,x.jsx)("div",{className:"discussion-card scroll-reveal hover-lift",style:{animationDelay:"".concat(.1*n,"s")},onClick:c,children:(0,x.jsxs)("div",{className:"discussion-card-content",children:[(0,x.jsx)("div",{className:"discussion-vote-section",children:(0,x.jsx)(d.A,{itemId:i.id,itemType:"discussion",initialScore:i.score||0,initialUpvotes:i.upvotes||0,initialDownvotes:i.downvotes||0,initialUserVote:i.userVote||null,userId:r})}),(0,x.jsxs)("div",{className:"discussion-main-content",children:[(0,x.jsx)("div",{className:"discussion-category-badge",children:i.category||"General"}),(0,x.jsxs)("div",{className:"tooltip-trigger",children:[(0,x.jsx)("h4",{children:i.title}),(0,x.jsxs)("span",{className:"tooltip-content",children:[null===(s=i.content)||void 0===s?void 0:s.substring(0,150),"..."]})]}),(0,x.jsxs)("p",{children:[null===(t=i.content)||void 0===t?void 0:t.substring(0,100),"..."]}),(0,x.jsxs)("div",{className:"discussion-meta",children:[(0,x.jsxs)("span",{children:["\ud83d\udc64 ",i.username]}),(0,x.jsxs)("span",{children:["\ud83d\udcac ",i.replies||0]}),(0,x.jsxs)("span",{children:["\ud83d\udc41\ufe0f ",i.views||0]})]}),(0,x.jsx)("button",{className:"join-btn ripple-button",onClick:l,children:"Join Discussion"})]})]})})});j.displayName="DiscussionCard";const y=(0,a.memo)(e=>{let{index:s}=e;return(0,x.jsxs)("div",{className:"discussion-card skeleton",style:{animationDelay:"".concat(.1*s,"s")},children:[(0,x.jsx)("div",{className:"skeleton",style:{width:"120px",height:"24px",marginBottom:"1rem"}}),(0,x.jsx)("div",{className:"skeleton",style:{width:"80%",height:"28px",marginBottom:"0.5rem"}}),(0,x.jsx)("div",{className:"skeleton",style:{width:"100%",height:"60px",marginBottom:"1rem"}}),(0,x.jsxs)("div",{style:{display:"flex",gap:"1rem",marginBottom:"1rem"},children:[(0,x.jsx)("div",{className:"skeleton",style:{width:"80px",height:"20px"}}),(0,x.jsx)("div",{className:"skeleton",style:{width:"60px",height:"20px"}}),(0,x.jsx)("div",{className:"skeleton",style:{width:"70px",height:"20px"}})]}),(0,x.jsx)("div",{className:"skeleton",style:{width:"140px",height:"40px"}})]})});y.displayName="SkeletonCard";const f=function(){var e;const s=(0,n.zy)(),t=(0,n.Zp)(),[d,p]=(0,a.useState)([]),[f,b]=(0,a.useState)(!0),[w,N]=(0,a.useState)(null),[S,A]=(0,a.useState)(!1),[P,C]=(0,a.useState)({title:"",content:"",category:""}),[k,I]=(0,a.useState)(""),[D,L]=(0,a.useState)("All"),[q,E]=(0,a.useState)({page:1,limit:20,total:0,totalPages:1}),F=(0,h.d)(k,300);(0,a.useEffect)(()=>{if(!m.A.isAuthenticated()){if(!localStorage.getItem("agoraUser"))return void t("/login")}},[t]);const O={userId:localStorage.getItem("agoraUserId")||"AGORA-0001",username:"Sparsh",tagline:"Seeking truth through dialogue",belief:"Agnostic",categories:["Ethics","Free Will","Consciousness"]},T=(null===(e=s.state)||void 0===e?void 0:e.userData)||JSON.parse(localStorage.getItem("agoraUser")||JSON.stringify(O)),U=(0,a.useMemo)(()=>["All","Ethics","Free Will","Consciousness","Epistemology","Politics","Metaphysics"],[]),B=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;b(!0);try{const t="discussions_".concat(e,"_").concat(s||"all"),a=await async function(e,s){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4;const a=await g.get("discussions",e);if(a&&Date.now()-a.timestamp<t)return s().then(s=>{g.put("discussions",(0,i.A)((0,i.A)({},s),{},{id:e,timestamp:Date.now()}))}).catch(console.error),a;const n=await s();return await g.put("discussions",(0,i.A)((0,i.A)({},n),{},{id:e,timestamp:Date.now()})),n}(t,async()=>{let t="".concat(u.A.API_URL,"/discussions?page=").concat(e,"&limit=20");s&&"All"!==s&&(t+="&category=".concat(encodeURIComponent(s)));return(await fetch(t)).json()},3e4);a.discussions?(p(a.discussions||[]),a.pagination&&E(a.pagination)):N({message:"Failed to load discussions",type:"error"})}catch(t){console.error("Error fetching discussions:",t),N({message:"Network error. Using sample data.",type:"error"}),p([{id:1,title:"Is Free Will an Illusion?",content:"Join the debate on determinism vs. free will.",category:"Free Will",username:"Philosopher",replies:12,views:45},{id:2,title:"Ethics in Modern Society",content:"Share your thoughts on evolving moral standards.",category:"Ethics",username:"Thinker",replies:8,views:32}])}finally{b(!1)}},[]);(0,a.useEffect)(()=>{B()},[B]);const M=(0,a.useCallback)(async e=>{if(e.preventDefault(),P.title&&P.content){b(!0);try{const e=await fetch("".concat(u.A.API_URL,"/discussions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:T.userId,username:T.username,title:P.title,content:P.content,category:P.category||"General"})}),s=await e.json();e.ok?(N({message:"Discussion created successfully!",type:"success"}),A(!1),C({title:"",content:"",category:""}),B()):N({message:s.message||"Failed to create discussion",type:"error"})}catch(s){console.error("Error creating discussion:",s),N({message:"Network error. Please try again.",type:"error"})}finally{b(!1)}}else N({message:"Please fill in all fields",type:"error"})},[P,T.username,T.userId,B]),_=((0,a.useCallback)(async()=>{await m.A.logout(),t("/login")},[t]),(0,a.useMemo)(()=>d.filter(e=>{var s,t;const i=(null===(s=e.title)||void 0===s?void 0:s.toLowerCase().includes(F.toLowerCase()))||(null===(t=e.content)||void 0===t?void 0:t.toLowerCase().includes(F.toLowerCase())),a="All"===D||e.category===D;return i&&a}),[d,F,D]));return(0,x.jsxs)(o.P.div,(0,i.A)((0,i.A)({},v),{},{children:[w&&(0,x.jsx)(r.A,{message:w.message,type:w.type,onClose:()=>N(null)}),(0,x.jsx)(c.A,{}),(0,x.jsxs)("div",{className:"dashboard-bg",children:[(0,x.jsxs)("main",{className:"dashboard-main",children:[(0,x.jsxs)("section",{className:"dashboard-welcome",children:[(0,x.jsxs)("h1",{children:["Welcome, ",(0,x.jsx)("span",{className:"username-highlight",children:T.username})]}),(0,x.jsx)("p",{className:"tagline",children:T.tagline})]}),(0,x.jsxs)("section",{className:"dashboard-info scroll-reveal",children:[(0,x.jsxs)("div",{className:"info-card",children:[(0,x.jsx)("h3",{children:"Your Profile"}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"ID:"})," ",T.userId]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Belief:"})," ",T.belief||"Not specified"]})]}),(0,x.jsxs)("div",{className:"info-card",children:[(0,x.jsx)("h3",{children:"Your Interests"}),(0,x.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:(T.categories||[]).map((e,s)=>(0,x.jsx)("li",{className:"category-pill",children:e},s))})]}),(0,x.jsxs)("div",{className:"info-card scroll-reveal",children:[(0,x.jsx)("h3",{children:"Stats"}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Discussions:"})," ",(0,x.jsx)(l.A,{end:d.length})]}),(0,x.jsxs)("p",{children:[(0,x.jsx)("strong",{children:"Active:"})," Today"]})]})]}),(0,x.jsxs)("section",{className:"dashboard-discussion",children:[(0,x.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem",flexWrap:"wrap",gap:"1rem"},children:[(0,x.jsx)("h2",{children:"Latest Discussions"}),(0,x.jsx)("button",{className:"create-discussion-btn",onClick:()=>A(!0),children:"\u2795 Start Discussion"})]}),(0,x.jsxs)("div",{className:"search-filter-section",children:[(0,x.jsx)("input",{type:"text",className:"search-input",placeholder:"\ud83d\udd0d Search discussions...",value:k,onChange:e=>I(e.target.value),"aria-label":"Search discussions"}),(0,x.jsxs)("select",{className:"filter-select glow-on-hover",value:D,onChange:e=>{L(e.target.value),B(1,e.target.value)},"aria-label":"Filter by category",children:[(0,x.jsx)("option",{value:"All",children:"All Categories"}),U.map((e,s)=>(0,x.jsx)("option",{value:e,children:e},s))]})]}),f?(0,x.jsx)("div",{className:"discussion-list",children:[1,2,3].map(e=>(0,x.jsx)(y,{index:e},e))}):0===_.length?(0,x.jsx)("div",{className:"no-discussions",children:(0,x.jsx)("p",{children:k||"All"!==D?"No discussions match your search.":"No discussions yet. Be the first to start one!"})}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"discussion-list",children:_.map((e,s)=>(0,x.jsx)(j,{disc:e,index:s,onNavigate:t,userId:T.userId},e.id))}),q.totalPages>1&&(0,x.jsxs)("div",{className:"pagination-controls",style:{display:"flex",justifyContent:"center",gap:"1rem",marginTop:"2rem",alignItems:"center"},children:[(0,x.jsx)("button",{className:1===q.page?"":"ripple-button",onClick:()=>B(q.page-1,D),disabled:1===q.page,style:{padding:"0.5rem 1rem",background:1===q.page?"#ccc":"var(--primary-color)",color:"#fff",border:"none",borderRadius:"4px",cursor:1===q.page?"not-allowed":"pointer"},"aria-label":"Previous page",children:"\u2190 Previous"}),(0,x.jsxs)("span",{style:{color:"var(--text-color)"},children:["Page ",q.page," of ",q.totalPages]}),(0,x.jsx)("button",{className:q.page===q.totalPages?"":"ripple-button",onClick:()=>B(q.page+1,D),disabled:q.page===q.totalPages,style:{padding:"0.5rem 1rem",background:q.page===q.totalPages?"#ccc":"var(--primary-color)",color:"#fff",border:"none",borderRadius:"4px",cursor:q.page===q.totalPages?"not-allowed":"pointer"},"aria-label":"Next page",children:"Next \u2192"})]})]})]})]}),S&&(0,x.jsx)("div",{className:"modal-overlay",onClick:()=>A(!1),children:(0,x.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,x.jsxs)("div",{className:"modal-header",children:[(0,x.jsx)("h2",{children:"\ud83c\udfdb\ufe0f Start a New Discussion"}),(0,x.jsx)("button",{className:"modal-close",onClick:()=>A(!1),children:"\u2715"})]}),(0,x.jsxs)("form",{onSubmit:M,children:[(0,x.jsxs)("div",{className:"form-group",children:[(0,x.jsx)("label",{children:"Discussion Title"}),(0,x.jsx)("input",{type:"text",placeholder:"What's on your mind?",value:P.title,onChange:e=>C((0,i.A)((0,i.A)({},P),{},{title:e.target.value})),required:!0,minLength:5,maxLength:200,"aria-label":"Discussion title","aria-required":"true"}),(0,x.jsxs)("small",{className:"char-count","aria-live":"polite",children:[P.title.length,"/200 characters"]})]}),(0,x.jsxs)("div",{className:"form-group",children:[(0,x.jsx)("label",{children:"Category"}),(0,x.jsxs)("select",{value:P.category,onChange:e=>C((0,i.A)((0,i.A)({},P),{},{category:e.target.value})),children:[(0,x.jsx)("option",{value:"",children:"Select a category..."}),U.map((e,s)=>(0,x.jsx)("option",{value:e,children:e},s))]})]}),(0,x.jsxs)("div",{className:"form-group",children:[(0,x.jsx)("label",{children:"Content"}),(0,x.jsx)("textarea",{placeholder:"Share your thoughts...",value:P.content,onChange:e=>C((0,i.A)((0,i.A)({},P),{},{content:e.target.value})),rows:6,required:!0,minLength:10,maxLength:5e3,"aria-label":"Discussion content","aria-required":"true"}),(0,x.jsxs)("small",{className:"char-count","aria-live":"polite",children:[P.content.length,"/5000 characters"]})]}),(0,x.jsxs)("div",{className:"modal-actions",children:[(0,x.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>A(!1),children:"Cancel"}),(0,x.jsx)("button",{type:"submit",className:"submit-btn",children:"Create Discussion"})]})]})]})})]})]}))}},6255:(e,s,t)=>{t.d(s,{d:()=>a});var i=t(5043);function a(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;const[t,a]=(0,i.useState)(e);return(0,i.useEffect)(()=>{const t=setTimeout(()=>{a(e)},s);return()=>{clearTimeout(t)}},[e,s]),t}},6995:(e,s,t)=>{t.d(s,{A:()=>o});var i=t(5043),a=t(3488),n=t(579);const o=function(e){let{itemId:s,itemType:t,initialScore:o=0,initialUpvotes:r=0,initialDownvotes:c=0,initialUserVote:l=null,userId:d,discussionId:u=null,onVoteChange:h=null,disabled:m=!1}=e;const[g,p]=(0,i.useState)(o),[v,x]=(0,i.useState)(r),[j,y]=(0,i.useState)(c),[f,b]=(0,i.useState)(l),[w,N]=(0,i.useState)(!1),[S,A]=(0,i.useState)(!1);(0,i.useEffect)(()=>{p(o),x(r),y(c),b(l)},[o,r,c,l]);const P=async e=>{if(d){if(!w&&!m){N(!0),A(!0);try{const i="discussion"===t?"".concat(a.A.API_URL,"/discussions/").concat(s,"/vote"):"".concat(a.A.API_URL,"/replies/").concat(s,"/vote"),n="discussion"===t?{userId:d,voteType:e}:{userId:d,voteType:e,discussionId:u},o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await o.json();o.ok?(p(r.score),x(r.upvotes),y(r.downvotes),b(r.vote),h&&h({score:r.score,upvotes:r.upvotes,downvotes:r.downvotes,userVote:r.vote})):console.error("Vote error:",r.message)}catch(i){console.error("Error voting:",i)}finally{N(!1),setTimeout(()=>A(!1),300)}}}else alert("Please login to vote")};return(0,n.jsxs)("div",{className:"vote-container ".concat(S?"animating":""),children:[(0,n.jsx)("button",{className:"vote-btn upvote-btn ".concat("upvote"===f?"active":""," ").concat(w?"voting":""),onClick:()=>P("upvote"),disabled:w||m,title:"Upvote (".concat(v,")"),"aria-label":"Upvote",children:(0,n.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vote-icon",children:(0,n.jsx)("path",{d:"M12 4L4 12h5v8h6v-8h5z",fill:"currentColor"})})}),(0,n.jsxs)("div",{className:"vote-score ".concat(g>0?"positive":g<0?"negative":"neutral"),children:[(0,n.jsx)("span",{className:"score-number",children:(C=g,C>=1e6?(C/1e6).toFixed(1)+"M":C>=1e3?(C/1e3).toFixed(1)+"k":C.toString())}),Math.abs(g)>0&&(0,n.jsx)("div",{className:"score-breakdown",title:"".concat(v," upvotes, ").concat(j," downvotes"),children:(0,n.jsxs)("span",{className:"breakdown-text",children:[(v/(v+j||1)*100).toFixed(0),"% upvoted"]})})]}),(0,n.jsx)("button",{className:"vote-btn downvote-btn ".concat("downvote"===f?"active":""," ").concat(w?"voting":""),onClick:()=>P("downvote"),disabled:w||m,title:"Downvote (".concat(j,")"),"aria-label":"Downvote",children:(0,n.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",className:"vote-icon",children:(0,n.jsx)("path",{d:"M12 20L4 12h5V4h6v8h5z",fill:"currentColor"})})})]});var C}}}]);
//# sourceMappingURL=791.4521f0dd.chunk.js.map